<?php

use GeoIp2\Database\Reader;

require __DIR__ . '/geoip2.phar';
$readerCountry = new Reader('C:/Users/User/Desktop/test-docs/3snet.co/apileads/GeoLite2-Country.mmdb');
$readerCity = new Reader('C:/Users/User/Desktop/test-docs/3snet.co/apileads/GeoLite2-City.mmdb');

$url = 'http://affiliate.apileads.tech/api/lead-create';

$langs = ['AD' => 'CA',
    'AE' => 'AR',
    'AF' => 'FA',
    'AG' => 'HEN',
    'AI' => 'EN',
    'AL' => 'SQ',
    'AM' => 'HY',
    'AO' => 'PT',
    'AR' => 'ES',
    'AS' => 'EN',
    'AT' => 'DE',
    'AU' => 'EN',
    'AW' => 'NL',
    'AX' => 'SV',
    'AZ' => 'AZ',
    'BA' => 'BS',
    'BB' => 'EN',
    'BD' => 'BN',
    'BE' => 'NL',
    'BF' => 'FR',
    'BG' => 'BG',
    'BH' => 'AR',
    'BI' => 'FR',
    'BJ' => 'FR',
    'BL' => 'FR',
    'BM' => 'EN',
    'BN' => 'MS',
    'BO' => 'ES',
    'BQ' => 'NL',
    'BR' => 'PT',
    'BS' => 'EN',
    'BT' => 'DZ',
    'BV' => 'NO',
    'BW' => 'EN',
    'BY' => 'BE',
    'BZ' => 'EN',
    'CA' => 'EN',
    'CC' => 'EN',
    'CD' => 'FR',
    'CF' => 'FR',
    'CG' => 'FR',
    'CH' => 'DE',
    'CI' => 'FR',
    'CK' => 'EN',
    'CL' => 'ES',
    'CM' => 'FR',
    'CN' => 'ZH',
    'CO' => 'ES',
    'CR' => 'ES',
    'CU' => 'ES',
    'CV' => 'PT',
    'CW' => 'NL',
    'CX' => 'EN',
    'CY' => 'EL',
    'CZ' => 'CS',
    'DE' => 'DE',
    'DJ' => 'FR',
    'DK' => 'DA',
    'DM' => 'EN',
    'DO' => 'ES',
    'DZ' => 'AR',
    'EC' => 'ES',
    'EE' => 'ET',
    'EG' => 'AR',
    'EH' => 'AR',
    'ER' => 'TI',
    'ES' => 'ES',
    'ET' => 'AM',
    'FI' => 'FI',
    'FJ' => 'EN',
    'FK' => 'EN',
    'FM' => 'EN',
    'FO' => 'FO',
    'FR' => 'FR',
    'GA' => 'FR',
    'GB' => 'EN',
    'GD' => 'EN',
    'GE' => 'KA',
    'GF' => 'FR',
    'GG' => 'EN',
    'GH' => 'EN',
    'GI' => 'EN',
    'GL' => 'KL',
    'GM' => 'EN',
    'GN' => 'FR',
    'GP' => 'FR',
    'GQ' => 'ES',
    'GR' => 'EL',
    'GS' => 'EN',
    'GT' => 'ES',
    'GU' => 'EN',
    'GW' => 'PT',
    'GY' => 'EN',
    'HK' => 'ZH',
    'HM' => 'EN',
    'HN' => 'ES',
    'HR' => 'HR',
    'HT' => 'FR',
    'HU' => 'HU',
    'ID' => 'ID',
    'IE' => 'EN',
    'IL' => 'HE',
    'IM' => 'EN',
    'IN' => 'HI',
    'IO' => 'EN',
    'IQ' => 'AR',
    'IR' => 'FA',
    'IS' => 'IS',
    'IT' => 'IT',
    'JE' => 'EN',
    'JM' => 'EN',
    'JO' => 'AR',
    'JP' => 'JA',
    'KE' => 'SW',
    'KG' => 'KY',
    'KH' => 'KM',
    'KI' => 'EN',
    'KM' => 'BNT',
    'KN' => 'EN',
    'KP' => 'KO',
    'KR' => 'KO',
    'KW' => 'AR',
    'KY' => 'EN',
    'KZ' => 'KK',
    'LA' => 'LO',
    'LB' => 'AR',
    'LC' => 'EN',
    'LI' => 'DE',
    'LK' => 'SI',
    'LR' => 'EN',
    'LS' => 'EN',
    'LT' => 'LT',
    'LU' => 'LB',
    'LV' => 'LV',
    'LY' => 'AR',
    'MA' => 'AR',
    'MC' => 'FR',
    'MD' => 'RU',
    'ME' => 'SR',
    'MF' => 'FR',
    'MG' => 'MG',
    'MH' => 'EN',
    'MK' => 'MK',
    'ML' => 'FR',
    'MM' => 'MY',
    'MN' => 'MN',
    'MO' => 'ZH',
    'MP' => 'CH',
    'MQ' => 'FR',
    'MR' => 'AR',
    'MS' => 'EN',
    'MT' => 'MT',
    'MU' => 'MFE',
    'MV' => 'DV',
    'MW' => 'EN',
    'MX' => 'ES',
    'MY' => 'MS',
    'MZ' => 'PT',
    'NA' => 'EN',
    'NC' => 'FR',
    'NE' => 'FR',
    'NF' => 'EN',
    'NG' => 'EN',
    'NI' => 'ES',
    'NL' => 'NL',
    'NO' => 'NB',
    'NP' => 'NE',
    'NR' => 'NA',
    'NU' => 'NIU',
    'NZ' => 'MI',
    'OM' => 'AR',
    'PA' => 'ES',
    'PE' => 'ES',
    'PF' => 'FR',
    'PG' => 'EN',
    'PH' => 'EN',
    'PK' => 'EN',
    'PL' => 'PL',
    'PM' => 'FR',
    'PN' => 'EN',
    'PR' => 'ES',
    'PS' => 'AR',
    'PT' => 'PT',
    'PW' => 'EN',
    'PY' => 'ES',
    'QA' => 'AR',
    'RE' => 'FR',
    'RO' => 'RO',
    'RS' => 'SR',
    'RU' => 'RU',
    'RW' => 'RW',
    'SA' => 'AR',
    'SB' => 'EN',
    'SC' => 'FR',
    'SD' => 'AR',
    'SE' => 'SV',
    'SG' => 'EN',
    'SH' => 'EN',
    'SI' => 'SL',
    'SJ' => 'NO',
    'SK' => 'SK',
    'SL' => 'EN',
    'SM' => 'IT',
    'SN' => 'FR',
    'SO' => 'SO',
    'SR' => 'NL',
    'ST' => 'PT',
    'SS' => 'EN',
    'SV' => 'ES',
    'SX' => 'NL',
    'SY' => 'AR',
    'SZ' => 'EN',
    'TC' => 'EN',
    'TD' => 'FR',
    'TF' => 'FR',
    'TG' => 'FR',
    'TH' => 'TH',
    'TJ' => 'TG',
    'TK' => 'TKL',
    'TL' => 'PT',
    'TM' => 'TK',
    'TN' => 'AR',
    'TO' => 'EN',
    'TR' => 'TR',
    'TT' => 'EN',
    'TV' => 'EN',
    'TW' => 'ZH',
    'TZ' => 'SW',
    'UA' => 'UK',
    'UG' => 'EN',
    'UM' => 'EN',
    'US' => 'EN',
    'UY' => 'ES',
    'UZ' => 'UZ',
    'VA' => 'IT',
    'VC' => 'EN',
    'VE' => 'ES',
    'VG' => 'EN',
    'VI' => 'EN',
    'VN' => 'VI',
    'VU' => 'BI',
    'WF' => 'FR',
    'WS' => 'SM',
    'YE' => 'AR',
    'YT' => 'FR',
    'ZA' => 'AF',
    'ZM' => 'EN',
    'ZW' => 'EN'
];
$phoneCode = [
    'VA' => 396698,
    'TL' => 67078,
    'LY' => 21821,
    'TV' => 6882,
    'NF' => 6723,
    'AQ' => 6721,
    'AN' => 5999,
    'JM' => 1876,
    'KN' => 1869,
    'TT' => 1868,
    'DO' => 1849,
    'VC' => 1784,
    'DM' => 1767,
    'LC' => 1758,
    'SX' => 1721,
    'AS' => 1684,
    'GU' => 1671,
    'MP' => 1670,
    'MS' => 1664,
    'TC' => 1649,
    'GD' => 1473,
    'BM' => 1441,
    'KY' => 1345,
    'VI' => 1340,
    'VG' => 1284,
    'AG' => 1268,
    'AI' => 1264,
    'BB' => 1246,
    'BS' => 1242,
    'UZ' => 998,
    'KG' => 996,
    'GE' => 995,
    'AZ' => 994,
    'TM' => 993,
    'TJ' => 992,
    'NP' => 977,
    'MN' => 976,
    'BT' => 975,
    'QA' => 974,
    'BH' => 973,
    'IL' => 972,
    'AE' => 971,
    'PS' => 970,
    'OM' => 968,
    'YE' => 967,
    'SA' => 966,
    'KW' => 965,
    'IQ' => 964,
    'SY' => 963,
    'JO' => 962,
    'LB' => 961,
    'MV' => 960,
    'TW' => 886,
    'BD' => 880,
    'LA' => 856,
    'KH' => 855,
    'MO' => 853,
    'HK' => 852,
    'KP' => 850,
    'MH' => 692,
    'FM' => 691,
    'TK' => 690,
    'PF' => 689,
    'NC' => 687,
    'KI' => 686,
    'WS' => 685,
    'NU' => 683,
    'CK' => 682,
    'WF' => 681,
    'PW' => 680,
    'FJ' => 679,
    'VU' => 678,
    'SB' => 677,
    'TO' => 676,
    'PG' => 675,
    'NR' => 674,
    'BN' => 673,
    'ID' => 628,
    'CW' => 599,
    'UY' => 598,
    'SR' => 597,
    'MQ' => 596,
    'PY' => 595,
    'GF' => 594,
    'EC' => 593,
    'GY' => 592,
    'BO' => 591,
    'FR' => 590,
    'HT' => 509,
    'PA' => 507,
    'CR' => 506,
    'NI' => 505,
    'HN' => 504,
    'SV' => 503,
    'GT' => 502,
    'BZ' => 501,
    'FK' => 500,
    'LI' => 423,
    'SK' => 421,
    'CZ' => 420,
    'MK' => 389,
    'BA' => 387,
    'SI' => 386,
    'HR' => 385,
    'ME' => 382,
    'RS' => 381,
    'UA' => 380,
    'SM' => 378,
    'MC' => 377,
    'AD' => 376,
    'BY' => 375,
    'AM' => 374,
    'MD' => 373,
    'EE' => 372,
    'LV' => 371,
    'LT' => 370,
    'BG' => 359,
    'FI' => 358,
    'CY' => 357,
    'MT' => 356,
    'AL' => 355,
    'IS' => 354,
    'IE' => 353,
    'LU' => 352,
    'PT' => 351,
    'GI' => 350,
    'GL' => 299,
    'FO' => 298,
    'AW' => 297,
    'ER' => 291,
    'SH' => 290,
    'KM' => 269,
    'SZ' => 268,
    'BW' => 267,
    'LS' => 266,
    'MW' => 265,
    'NA' => 264,
    'ZW' => 263,
    'RE' => 262,
    'MG' => 261,
    'ZM' => 260,
    'MZ' => 258,
    'BI' => 257,
    'UG' => 256,
    'TZ' => 255,
    'KE' => 254,
    'DJ' => 253,
    'SO' => 252,
    'ET' => 251,
    'RW' => 250,
    'SD' => 249,
    'SC' => 248,
    'AC' => 247,
    'IO' => 246,
    'GW' => 245,
    'AO' => 244,
    'CD' => 243,
    'CG' => 242,
    'GA' => 241,
    'GQ' => 240,
    'ST' => 239,
    'CV' => 238,
    'CM' => 237,
    'CF' => 236,
    'TD' => 235,
    'NG' => 234,
    'GH' => 233,
    'SL' => 232,
    'LR' => 231,
    'MU' => 230,
    'BJ' => 229,
    'TG' => 228,
    'NE' => 227,
    'BF' => 226,
    'CI' => 225,
    'GN' => 224,
    'ML' => 223,
    'MR' => 222,
    'SN' => 221,
    'GM' => 220,
    'TN' => 216,
    'DZ' => 213,
    'MA' => 212,
    'SS' => 211,
    'IR' => 98,
    'MM' => 95,
    'LK' => 94,
    'AF' => 93,
    'PK' => 92,
    'IN' => 91,
    'TR' => 90,
    'CN' => 86,
    'VN' => 84,
    'KR' => 82,
    'JP' => 81,
    'KZ' => 77,
    'TH' => 66,
    'SG' => 65,
    'NZ' => 64,
    'PH' => 63,
    'AU' => 61,
    'MY' => 60,
    'VE' => 58,
    'CO' => 57,
    'CL' => 56,
    'BR' => 55,
    'AR' => 54,
    'CU' => 53,
    'MX' => 52,
    'PE' => 51,
    'DE' => 49,
    'PL' => 48,
    'NO' => 47,
    'SE' => 46,
    'DK' => 45,
    'GB' => 44,
    'AT' => 43,
    'CH' => 41,
    'RO' => 40,
    'IT' => 39,
    'HU' => 36,
    'ES' => 34,
    'BE' => 32,
    'NL' => 31,
    'GR' => 30,
    'ZA' => 27,
    'EG' => 20,
    'RU' => 7,
    'US' => 1,
    'CA' => 1,
];
$leadType = [
//    'loan',
    'general',
];

for ($i = 0; $i < 10000; $i++) {

//    sleep(random_int(1, 30));

    $ip = sprintf('%s.%s.%s.%s', random_int(1, 255), random_int(1, 255), random_int(1, 255), random_int(1, 255));
    try {
        $recordCountry = $readerCountry->country($ip);
        $recordCity = $readerCity->city($ip);
    } catch (Exception $exception) {
        echo json_encode([
            'success' => false,
            'err' => 'IP PARSE FAILED'
        ]) . "\n";
        continue;
    }

    $geo = $recordCountry->country->isoCode;
    $leadData = [
        'phone' => '9' . random_int('100000000', '999999999'),
        'phone_code' => $phoneCode[$geo],
        'email' => 'export_test' . random_int('100000000', '999999999') . '@test.3snet.co',
        'is_test' => 1,
        'firstname' => 'TestFirstname' . random_int(1, 9999999),
        'lastname' => 'TestLastname' . random_int(1, 9999999),
        'type' => $leadType[array_rand($leadType)],
        'user_agent' => 'Firefox ' . uniqid(),
        'geo' => $geo,
        'lang' => $langs[$recordCountry->country->isoCode],
        'city' => $recordCity->city->name,
        'country' => $recordCountry->country->isoCode,
        'ip' => $ip,
    ];
//    var_dump($leadData);
//    die();

    $curl = curl_init();

    curl_setopt_array($curl, [
        CURLOPT_URL => $url,
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_ENCODING => '',
        CURLOPT_MAXREDIRS => 10,
        CURLOPT_TIMEOUT => 0,
        CURLOPT_FOLLOWLOCATION => true,
        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
        CURLOPT_CUSTOMREQUEST => 'POST',
        CURLOPT_POSTFIELDS => http_build_query($leadData),
        CURLOPT_HTTPHEADER => [
            'User-Agent: PHP Test Script',
            'Content-Type: application/x-www-form-urlencoded',
            'key: iD9VvwpQkUV5bCXzVY2kN305HWhufuVH'
        ],
    ]);

    $response = curl_exec($curl);

//    echo '<pre>';
//    var_dump($response);
//    echo '</pre>';
//    die();

    curl_close($curl);

}
